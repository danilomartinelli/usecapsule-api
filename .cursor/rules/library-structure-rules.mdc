# Regras para Estrutura de Libraries no Workspace ACME

VocÃª estÃ¡ trabalhando com a estrutura de libraries do workspace ACME. Siga estas convenÃ§Ãµes rigorosas:

## ğŸ“ **Estrutura de Pastas**

### **`libs/contexts/` (Backend-only)**

- **PropÃ³sito**: Bounded Contexts DDD para lÃ³gica de negÃ³cio
- **Arquitetura**: Domain-Driven Design + Hexagonal Architecture
- **Uso**: Apenas projetos backend (NestJS microserviÃ§os)
- **Tags**: `scope:<context>,type:domain,arch:hexagonal`
- **Exemplos**: billing, deploy, discovery

### **`libs/shared/` (Full-stack)**

- **PropÃ³sito**: Compartilhado entre frontend e backend
- **Uso**: Qualquer projeto (apps, libs)
- **Tags**: `scope:shared,type:utils,arch:shared`
- **Exemplos**: DTOs, tipos, interfaces, utilitÃ¡rios

### **`libs/ui/` (Frontend-only)**

- **PropÃ³sito**: Componentes e bibliotecas de UI
- **Uso**: Apenas projetos frontend (React, Vue, etc.)
- **Tags**: `scope:shared,type:ui,arch:shared`
- **RestriÃ§Ã£o**: NÃ£o pode ser usado por projetos backend
- **Exemplos**: React components, design system, layouts

## ğŸ”— **Regras de DependÃªncias**

### **âœ… Permitido:**

#### **Frontend â†’ UI**

```typescript
// apps/portal/app/dashboard/page.tsx
import { Button, Card } from '@acme/ui/react';
```

#### **Frontend â†’ Shared**

```typescript
// apps/portal/app/api/client.ts
import { BaseResponseDto } from '@acme/shared/dto';
```

#### **Backend â†’ Contexts**

```typescript
// apps/api-gateway/src/billing/billing.controller.ts
import { CreateBillingUseCase } from '@acme/contexts/billing';
```

#### **Backend â†’ Shared**

```typescript
// apps/api-gateway/src/common/types.ts
import { BaseEntity } from '@acme/shared/types';
```

### **âŒ Proibido:**

#### **Backend â†’ UI**

```typescript
// âŒ NUNCA fazer isso
// apps/api-gateway/src/app.controller.ts
import { Button } from '@acme/ui/react'; // ERRO!
```

#### **Contexts â†’ UI**

```typescript
// âŒ NUNCA fazer isso
// libs/contexts/billing/src/application/use-cases/CreateBillingUseCase.ts
import { Button } from '@acme/ui/react'; // ERRO!
```

## ğŸ—ï¸ **CriaÃ§Ã£o de Novas Libraries**

### **Bounded Context (Backend)**

```bash
nx g @nx/js:library \
  --directory=libs/contexts/<context-name> \
  --name=contexts-<context-name> \
  --tags=scope:<context-name>,type:domain,arch:hexagonal \
  --bundler=none \
  --linter=eslint \
  --unitTestRunner=jest \
  --useProjectJson=true
```

### **Shared Library (Full-stack)**

```bash
nx g @nx/js:library \
  --directory=libs/shared/<library-name> \
  --name=shared-<library-name> \
  --tags=scope:shared,type:utils,arch:shared \
  --bundler=none \
  --linter=eslint \
  --unitTestRunner=jest \
  --useProjectJson=true
```

### **UI Library (Frontend)**

```bash
nx g @nx/react:library \
  --directory=libs/ui/<framework> \
  --name=shared-ui-<framework> \
  --tags=scope:shared,type:ui,arch:shared \
  --bundler=vite \
  --linter=eslint \
  --unitTestRunner=jest \
  --style=tailwind \
  --useProjectJson=true
```

## ğŸ“‹ **Estrutura Interna das Libraries**

### **Bounded Contexts (DDD + Hexagonal)**

```
libs/contexts/<context>/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ domain/           # Entities, Value Objects, Events
â”‚   â”œâ”€â”€ application/      # Use Cases, Ports, DTOs
â”‚   â””â”€â”€ infrastructure/   # Adapters (opcional)
â”œâ”€â”€ package.json
â””â”€â”€ project.json
```

### **Shared Libraries**

```
libs/shared/<library>/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ base/            # Tipos/DTOs base
â”‚   â”œâ”€â”€ <context1>/      # Contexto especÃ­fico
â”‚   â””â”€â”€ <context2>/      # Contexto especÃ­fico
â”œâ”€â”€ package.json
â””â”€â”€ project.json
```

### **UI Libraries**

```
libs/ui/<framework>/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ components/      # Componentes React
â”‚   â”œâ”€â”€ theme/          # Sistema de design
â”‚   â”œâ”€â”€ hooks/          # Hooks customizados
â”‚   â””â”€â”€ utils/          # UtilitÃ¡rios de UI
â”œâ”€â”€ tailwind.config.js  # ConfiguraÃ§Ã£o Tailwind
â”œâ”€â”€ package.json
â””â”€â”€ project.json
```

## ğŸ¯ **Nomenclatura**

### **Nomes de Libraries**

- **Contexts**: `contexts-<context-name>` (ex: `contexts-billing`)
- **Shared**: `shared-<library-name>` (ex: `shared-dto`)
- **UI**: `shared-ui-<framework>` (ex: `shared-ui-react`)

### **Nomes de Pacotes**

- **Contexts**: `@acme/contexts-<context-name>`
- **Shared**: `@acme/shared-<library-name>`
- **UI**: `@acme/shared-ui-<framework>`

## ğŸ” **ValidaÃ§Ã£o de DependÃªncias**

### **Verificar DependÃªncias**

```bash
# Ver dependÃªncias de um projeto
nx dep-graph --focus=contexts-billing

# Ver dependÃªncias de UI
nx dep-graph --focus=shared-ui-react

# Verificar se hÃ¡ violaÃ§Ãµes
nx lint contexts-billing
```

### **Filtros por Tipo**

```bash
# Ver apenas bounded contexts
nx graph --focus="type:domain"

# Ver apenas UI libraries
nx graph --focus="type:ui"

# Ver apenas shared libraries
nx graph --focus="scope:shared"
```

## ğŸš¨ **Anti-patterns a Evitar**

### **âŒ NÃ£o fazer:**

- Criar UI libraries em `libs/contexts/`
- Criar bounded contexts em `libs/ui/`
- Usar UI libraries em projetos backend
- Misturar responsabilidades entre pastas
- Quebrar a separaÃ§Ã£o frontend/backend

### **âœ… Fazer:**

- Manter separaÃ§Ã£o clara de responsabilidades
- Usar tags adequadas para cada library
- Seguir convenÃ§Ãµes de nomenclatura
- Validar dependÃªncias antes de commitar
- Documentar mudanÃ§as na estrutura

## ğŸ“š **DocumentaÃ§Ã£o**

### **README de cada Library**

Cada library deve ter um README.md com:

- **PropÃ³sito** da library
- **Como usar** (exemplos)
- **DependÃªncias** permitidas
- **Estrutura** interna
- **Exemplos** de uso

### **Exemplo de README**

````markdown
# @acme/contexts-billing

Bounded Context para gerenciamento de cobranÃ§a no ACME.

## Uso

```typescript
import { CreateBillingUseCase } from '@acme/contexts/billing';
```
````

## DependÃªncias

- âœ… `@acme/shared/types`
- âŒ `@acme/shared-ui-react` (nÃ£o permitido)

````

## ğŸ—ï¸ **Exemplos de Libraries Existentes**

### **Contexts (Backend)**
- `libs/contexts/billing/` - Gerenciamento de cobranÃ§a
- `libs/contexts/deploy/` - Gerenciamento de deploys
- `libs/contexts/discovery/` - Service discovery

### **Shared (Full-stack)**
- `libs/shared/dto/` - Data Transfer Objects
- `libs/shared/types/` - Tipos TypeScript compartilhados

### **UI (Frontend)**
- `libs/ui/react/` - Componentes React reutilizÃ¡veis

## ğŸ”§ **ConfiguraÃ§Ã£o de Projetos**

### **project.json para Contexts**
```json
{
  "name": "contexts-billing",
  "tags": ["scope:billing", "type:domain", "arch:hexagonal"],
  "targets": {
    "build": {
      "executor": "@nx/js:tsc",
      "outputs": ["{options.outputPath}"],
      "options": {
        "outputPath": "dist/libs/contexts/billing",
        "main": "libs/contexts/billing/src/index.ts",
        "tsConfig": "libs/contexts/billing/tsconfig.lib.json"
      }
    }
  }
}
````

### **project.json para UI**

```json
{
  "name": "shared-ui-react",
  "tags": ["scope:shared", "type:ui", "arch:shared"],
  "targets": {
    "build": {
      "executor": "@nx/vite:build",
      "outputs": ["{options.outputPath}"],
      "options": {
        "outputPath": "dist/libs/ui/react"
      }
    }
  }
}
```

## ğŸ§ª **Testes**

### **Estrutura de Testes**

```
libs/contexts/billing/
â”œâ”€â”€ src/
â”‚   â””â”€â”€ domain/
â”‚       â””â”€â”€ entities/
â”‚           â”œâ”€â”€ BillingEntity.ts
â”‚           â””â”€â”€ __tests__/
â”‚               â””â”€â”€ BillingEntity.spec.ts
```

### **Testes por Tipo**

- **Domain**: Teste regras de negÃ³cio
- **Application**: Teste casos de uso
- **Infrastructure**: Teste adapters
- **UI**: Teste componentes React

## ğŸ“¦ **PublicaÃ§Ã£o e Versionamento**

### **Package.json**

```json
{
  "name": "@acme/contexts-billing",
  "version": "0.0.1",
  "type": "commonjs",
  "main": "./src/index.ts",
  "types": "./src/index.ts",
  "exports": {
    ".": {
      "import": "./src/index.ts",
      "require": "./src/index.ts"
    }
  }
}
```

### **Index.ts**

```typescript
// libs/contexts/billing/src/index.ts
export * from './domain/entities/BillingEntity';
export * from './application/use-cases/CreateBillingUseCase';
export * from './application/ports/BillingRepository.port';
```

## ğŸ”„ **MigraÃ§Ã£o e RefatoraÃ§Ã£o**

### **Quando Migrar**

- Quando uma funcionalidade Ã© usada em mÃºltiplos projetos
- Quando hÃ¡ lÃ³gica de negÃ³cio complexa que pode ser isolada
- Quando hÃ¡ componentes UI reutilizÃ¡veis
- Quando hÃ¡ tipos/DTOs compartilhados

### **Processo de MigraÃ§Ã£o**

1. **Identificar** cÃ³digo candidato Ã  migraÃ§Ã£o
2. **Criar** nova library com estrutura adequada
3. **Mover** cÃ³digo para a nova library
4. **Atualizar** imports nos projetos existentes
5. **Testar** funcionalidade
6. **Documentar** mudanÃ§as
   description:
   globs:
   alwaysApply: false

---
