# Multi-Environment Flyway Configuration for Auth Service
#
# This configuration file supports multiple deployment environments:
# - test: Unit/integration testing
# - local: Local development
# - development: Development server
# - staging: Staging/pre-production
# - production: Production environment
# - canary: Canary deployment
#
# Environment selection is based on APP_ENV environment variable.
# Default environment: local
#
# Usage:
#   flyway -configFiles=flyway.conf migrate
#   APP_ENV=test flyway -configFiles=flyway.conf migrate
#   APP_ENV=production flyway -configFiles=flyway.conf migrate

# Common configuration for all environments
flyway.schemas=public
flyway.locations=filesystem:./migrations
flyway.baselineOnMigrate=true
flyway.validateOnMigrate=true
flyway.cleanDisabled=false
flyway.group=true

# Test Environment Configuration
flyway.url=${FLYWAY_URL_TEST:-jdbc:postgresql://localhost:5432/auth_service_test_db}
flyway.user=${FLYWAY_USER_TEST:-auth_test_user}
flyway.password=${FLYWAY_PASSWORD_TEST:-auth_test_pass}

# Local Environment Configuration (Default)
flyway.url=${FLYWAY_URL_LOCAL:-jdbc:postgresql://localhost:7110/auth_service_db}
flyway.user=${FLYWAY_USER_LOCAL:-auth_user}
flyway.password=${FLYWAY_PASSWORD_LOCAL:-auth_pass}

# Development Environment Configuration
flyway.url=${FLYWAY_URL_DEV:-jdbc:postgresql://dev-postgres:5432/auth_service_db}
flyway.user=${FLYWAY_USER_DEV:-auth_dev_user}
flyway.password=${FLYWAY_PASSWORD_DEV:-auth_dev_pass}

# Staging Environment Configuration
flyway.url=${FLYWAY_URL_STAGING:-jdbc:postgresql://staging-postgres:5432/auth_service_db}
flyway.user=${FLYWAY_USER_STAGING:-auth_staging_user}
flyway.password=${FLYWAY_PASSWORD_STAGING:-auth_staging_pass}

# Production Environment Configuration
flyway.url=${FLYWAY_URL_PROD:-jdbc:postgresql://prod-postgres:5432/auth_service_db}
flyway.user=${FLYWAY_USER_PROD:-auth_prod_user}
flyway.password=${FLYWAY_PASSWORD_PROD:-auth_prod_pass}

# Canary Environment Configuration
flyway.url=${FLYWAY_URL_CANARY:-jdbc:postgresql://canary-postgres:5432/auth_service_db}
flyway.user=${FLYWAY_USER_CANARY:-auth_canary_user}
flyway.password=${FLYWAY_PASSWORD_CANARY:-auth_canary_pass}

# Environment-specific settings
# These override the defaults based on environment
# Use environment variables like: APP_ENV=production flyway migrate

# Default to local environment if no APP_ENV specified
flyway.url=${FLYWAY_URL:-${FLYWAY_URL_LOCAL}}
flyway.user=${FLYWAY_USER:-${FLYWAY_USER_LOCAL}}
flyway.password=${FLYWAY_PASSWORD:-${FLYWAY_PASSWORD_LOCAL}}
