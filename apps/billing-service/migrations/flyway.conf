# Multi-Environment Flyway Configuration for Billing Service
#
# This configuration file supports multiple deployment environments:
# - test: Unit/integration testing
# - local: Local development
# - development: Development server
# - staging: Staging/pre-production
# - production: Production environment
# - canary: Canary deployment
#
# Environment selection is based on APP_ENV environment variable.
# Default environment: local
#
# Usage:
#   flyway -configFiles=flyway.conf migrate
#   APP_ENV=test flyway -configFiles=flyway.conf migrate
#   APP_ENV=production flyway -configFiles=flyway.conf migrate

# Common configuration for all environments
flyway.schemas=public
flyway.locations=filesystem:./migrations
flyway.baselineOnMigrate=true
flyway.validateOnMigrate=true
flyway.cleanDisabled=false
flyway.group=true

# Test Environment Configuration
flyway.url=${FLYWAY_URL_TEST:-jdbc:postgresql://localhost:5432/billing_service_test_db}
flyway.user=${FLYWAY_USER_TEST:-billing_test_user}
flyway.password=${FLYWAY_PASSWORD_TEST:-billing_test_pass}

# Local Environment Configuration (Default)
flyway.url=${FLYWAY_URL_LOCAL:-jdbc:postgresql://localhost:7113/billing_service_db}
flyway.user=${FLYWAY_USER_LOCAL:-billing_user}
flyway.password=${FLYWAY_PASSWORD_LOCAL:-billing_pass}

# Development Environment Configuration
flyway.url=${FLYWAY_URL_DEV:-jdbc:postgresql://dev-postgres:5432/billing_service_db}
flyway.user=${FLYWAY_USER_DEV:-billing_dev_user}
flyway.password=${FLYWAY_PASSWORD_DEV:-billing_dev_pass}

# Staging Environment Configuration
flyway.url=${FLYWAY_URL_STAGING:-jdbc:postgresql://staging-postgres:5432/billing_service_db}
flyway.user=${FLYWAY_USER_STAGING:-billing_staging_user}
flyway.password=${FLYWAY_PASSWORD_STAGING:-billing_staging_pass}

# Production Environment Configuration
flyway.url=${FLYWAY_URL_PROD:-jdbc:postgresql://prod-postgres:5432/billing_service_db}
flyway.user=${FLYWAY_USER_PROD:-billing_prod_user}
flyway.password=${FLYWAY_PASSWORD_PROD:-billing_prod_pass}

# Canary Environment Configuration
flyway.url=${FLYWAY_URL_CANARY:-jdbc:postgresql://canary-postgres:5432/billing_service_db}
flyway.user=${FLYWAY_USER_CANARY:-billing_canary_user}
flyway.password=${FLYWAY_PASSWORD_CANARY:-billing_canary_pass}

# Environment-specific settings
# These override the defaults based on environment
# Use environment variables like: APP_ENV=production flyway migrate

# Default to local environment if no APP_ENV specified
flyway.url=${FLYWAY_URL:-${FLYWAY_URL_LOCAL}}
flyway.user=${FLYWAY_USER:-${FLYWAY_USER_LOCAL}}
flyway.password=${FLYWAY_PASSWORD:-${FLYWAY_PASSWORD_LOCAL}}