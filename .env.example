# ============================================================================
# Capsule Platform - Environment Configuration
# ============================================================================
# This file contains all environment variables required by the microservices
# in the Capsule Platform. Each service has its own section with specific
# configuration requirements.
#
# Usage:
#   - Copy this file to .env for local development
#   - Set appropriate values for your environment
#   - Use deployment tools to set production values
# ============================================================================

# ============================================================================
# Global Environment Configuration
# ============================================================================
# These variables are shared across multiple services

NODE_ENV=development
APP_ENV=local
LOG_LEVEL=info

# RabbitMQ Configuration (shared by all microservices)
RABBITMQ_URL=amqp://admin:admin@localhost:7010

# Redis Configuration (shared by all microservices)
REDIS_HOST=localhost
REDIS_PORT=7120
REDIS_PASSWORD=
REDIS_DB=0

# ============================================================================
# API Gateway Configuration
# ============================================================================
# HTTP entry point for the entire platform (Port 3000)

SERVICE_NAME=api-gateway
SERVICE_PORT=3000

# JWT Configuration
JWT_SECRET=your-super-secure-jwt-secret-key-minimum-32-chars
JWT_EXPIRATION=15m

# Rate Limiting
RATE_LIMIT_TTL=60
RATE_LIMIT_MAX=100

# CORS Configuration
CORS_ENABLED=true
CORS_ORIGINS=http://localhost:3000,http://localhost:3010

# ============================================================================
# Auth Service Configuration
# ============================================================================
# Authentication and user management microservice

SERVICE_NAME=auth-service
RABBITMQ_QUEUE=auth_queue

# Database Configuration
DB_HOST=localhost
DB_PORT=7110
DB_NAME=auth_service_db
DB_USER=auth_user
DB_PASSWORD=auth_pass
DB_SSL=false

# JWT Configuration
JWT_SECRET=your-super-secure-jwt-secret-key-minimum-32-chars
JWT_EXPIRATION=15m
JWT_REFRESH_EXPIRATION=7d

# Security
BCRYPT_ROUNDS=10

# GitHub OAuth (Optional)
GITHUB_CLIENT_ID=your-github-client-id
GITHUB_CLIENT_SECRET=your-github-client-secret

# ============================================================================
# Billing Service Configuration
# ============================================================================
# Subscription and payment processing microservice

SERVICE_NAME=billing-service
RABBITMQ_QUEUE=billing_queue

# Database Configuration
BILLING_DB_HOST=localhost
BILLING_DB_PORT=7113
BILLING_DB_NAME=billing_service_db
BILLING_DB_USER=billing_user
BILLING_DB_PASSWORD=billing_pass
BILLING_DB_SSL=false

# Stripe Configuration
STRIPE_SECRET_KEY=sk_test_your_stripe_secret_key
STRIPE_PUBLISHABLE_KEY=pk_test_your_stripe_publishable_key
STRIPE_WEBHOOK_SECRET=whsec_your_webhook_secret

# Billing Settings
BILLING_CURRENCY=usd
TRIAL_PERIOD_DAYS=14
INVOICE_GRACE_PERIOD_DAYS=7

# ============================================================================
# Deploy Service Configuration
# ============================================================================
# Container builds and Kubernetes deployment orchestration

SERVICE_NAME=deploy-service
RABBITMQ_QUEUE=deploy_queue

# Database Configuration
DEPLOY_DB_HOST=localhost
DEPLOY_DB_PORT=7111
DEPLOY_DB_NAME=deploy_service_db
DEPLOY_DB_USER=deploy_user
DEPLOY_DB_PASSWORD=deploy_pass
DEPLOY_DB_SSL=false

# Kubernetes Configuration
KUBERNETES_API_URL=https://kubernetes.default.svc:443
KUBERNETES_TOKEN=your-kubernetes-service-account-token
KUBERNETES_NAMESPACE=default

# Container Registry Configuration
REGISTRY_URL=registry.capsule.dev
REGISTRY_USERNAME=your-registry-username
REGISTRY_PASSWORD=your-registry-password

# Build Configuration
MAX_CONCURRENT_BUILDS=5
BUILD_TIMEOUT_SECONDS=600

# ============================================================================
# Monitor Service Configuration
# ============================================================================
# Metrics collection, observability, and alerting

SERVICE_NAME=monitor-service
RABBITMQ_QUEUE=monitor_queue

# Database Configuration
MONITOR_DB_HOST=localhost
MONITOR_DB_PORT=7112
MONITOR_DB_NAME=monitor_service_db
MONITOR_DB_USER=monitor_user
MONITOR_DB_PASSWORD=monitor_pass
MONITOR_DB_SSL=false

# Prometheus Configuration (Optional)
PROMETHEUS_URL=http://localhost:9090
PROMETHEUS_PUSHGATEWAY_URL=http://localhost:9091

# Grafana Configuration (Optional)
GRAFANA_URL=http://localhost:3000
GRAFANA_API_TOKEN=your-grafana-api-token

# Alertmanager Configuration (Optional)
ALERTMANAGER_URL=http://localhost:9093

# Metrics Settings
METRICS_COLLECTION_INTERVAL_SECONDS=60
METRICS_RETENTION_DAYS=90

# Alert Thresholds
ALERT_CPU_THRESHOLD_PERCENT=80
ALERT_MEMORY_THRESHOLD_PERCENT=85
ALERT_DISK_THRESHOLD_PERCENT=90

# ============================================================================
# Flyway Database Migration Configuration
# ============================================================================
# These variables are used by Flyway for database migrations across all services
# Set these when running database migrations for each service

# For Auth Service migrations
# FLYWAY_URL=jdbc:postgresql://localhost:7110/auth_service_db
# FLYWAY_USER=auth_user
# FLYWAY_PASSWORD=auth_pass

# For Billing Service migrations
# FLYWAY_URL=jdbc:postgresql://localhost:7113/billing_service_db
# FLYWAY_USER=billing_user
# FLYWAY_PASSWORD=billing_pass

# For Deploy Service migrations
# FLYWAY_URL=jdbc:postgresql://localhost:7111/deploy_service_db
# FLYWAY_USER=deploy_user
# FLYWAY_PASSWORD=deploy_pass

# For Monitor Service migrations
# FLYWAY_URL=jdbc:postgresql://localhost:7112/monitor_service_db
# FLYWAY_USER=monitor_user
# FLYWAY_PASSWORD=monitor_pass

# ============================================================================
# Development Notes
# ============================================================================
# 
# Port Allocation:
# - API Gateway: 3000 (HTTP)
# - RabbitMQ: 7010 (Management: 15672)
# - Redis: 7120
# - Auth DB: 7110
# - Deploy DB: 7111  
# - Monitor DB: 7112
# - Billing DB: 7113
#
# Security Reminders:
# - Change all default passwords in production
# - Use strong, unique JWT secrets (minimum 32 characters)
# - Enable SSL for database connections in production
# - Store sensitive credentials in secure secret management systems
# - Rotate API keys and tokens regularly
#
# Service Dependencies:
# - All services require RabbitMQ to be running
# - Each service requires its own PostgreSQL database
# - API Gateway is the only service accepting external HTTP traffic
# - Microservices communicate only via RabbitMQ message queues
